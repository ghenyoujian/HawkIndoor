# 🛠️ 开发日志
> 项目名称：  视觉标记点定位室内自主无人机系统开发   
> 日期：2025-07-10  
> 记录人：陈优健、李俊杰、林芷荧  
> 所属模块：视觉定位 / 轨迹规划  / 人机交互


---
## 📅  任务节点规划

| 时间周期            | 阶段目标         | 任务细化                                                                                                                                                     | 验收内容                                                                                                                    | 
|-----------------|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| **7月10日-7月13日** | 协作安排与仿真环境搭建  | - 确立协作方案的版本、完成任务安排与分工<br>- 安装Ubuntu + Python + MAVSDK + Flask + OpenCV等开发工具<br>- 建立github协作与开发日志协作<br>- 编译AprilTag检测库<br>- PX4飞控初始化 & QGC配置<br>- 无人机虚拟仿真环境 | <br>[  ] 仿真无人机飞行演示<br>[✅] 开发日志与github仓库<br>[✅] 协作方案                                                                     |
| **7月13日-7月17日** | TagSLAM先验模块  | - RDKX5板载计算机环境配置<br>- 基于RDKX5+鱼眼相机部署TagSLAM <br>- 在TagSLAM的基础上构建mark标识适配，封装mark先验地图采集模块                                                                  | [✅] mark先验地图采集模块docker环境包 <br>[✅]先验地图采集演示视频                                                                             |
| **7月16日-7月20日** | mark视觉定位模块   | - 基于RDKX5相机标定（OpenCV）<br>- 基于先验mark地图与鱼眼相机AprilTag识别 + solvePnP计算<br>- 实时Pose输出（带时间戳）<br>- 环境封装                                                          | [✅]  仿真无人机遥控飞行mark视觉定位演示  <br>[✅] Pose输出demo <br>[✅] mark视觉定位模块docker环境包 <br>[✅] 视觉模块整合环境包（先验地图+mark定位）<br>[✅] 视觉模块开发日志 |
| **7月19日-7月20日** | 飞控通信模块调试     | - 使用MAVSDK控制起飞/降落/切模式<br>- 设置Offboard + failsafe策略                                                                                                       | [✅] 基于MAVSDK通讯的无人机飞行控制演示视频 <br>[✅] 通讯接口设计源码                                                                             |
| **7月21日-7月25日** | EKF滤波轨迹控制    | - 构建扩展卡尔曼滤波器（EKF）<br>- 设计轨迹PID控制逻辑（速度控制优先）<br>- IMU数据融合与遥控信号优化控制器 <br>- 联合测试轨迹跟踪精度与控制平滑性                                        |  [✅] 
| **7月21日-7月25日** | Web轨迹可视化模块开发 | - 使用Three.js构建轨迹绘制界面<br>- Flask服务端通信 + WebSocket<br>- 实时显示无人机状态与轨迹                                                                                       |                                                                                                                         |
| **第5周**         | 系统联调与异常测试    | - 三模块集成测试：视觉 → 控制 → PX4<br>- 实现接口封装（轨迹/Pose/速度）<br>- 加入异常处理与failsafe策略                                                                                   |                                                                                                                         |
| **第6周**         | 项目部署 + 试飞验证  | - 部署AprilTag地图与坐标标定<br>- 真实环境飞行测试、日志采集<br>- 编写部署文档、演示视频、实验总结                                                                                             |                                                                                                                         |

---

## ⚠️ 当前问题与挑战

- AprilTag 在强光下偶尔误识别，需调整曝光或优化图像预处理
- Flask 后端对轨迹消息解析偶发异常（坐标未对齐）
- PX4 在切换 Offboard 模式时有短暂延迟，影响启动精度

---

## 🔄 接口对接进展

- [x] 视觉定位 → 控制模块：已通过 `Pose{timestamp, x, y, z, qw, qx, qy, qz}` 格式传递
- [x] 控制模块 → PX4：MAVSDK 每 20Hz 发出速度指令（set_velocity_ned）
- [ ] Three.js → Flask：轨迹上传接口待验证
- [x] Flask → 前端：无人机状态推送已稳定运行

---

## 📚 引用资料与链接

- AprilTag 检测库：https://github.com/AprilRobotics/apriltag  
- MAVSDK Python 文档：https://mavsdk.mavlink.io/main/en  
- PX4 参数调优参考：https://docs.px4.io/main/en/advanced_config  
- Flask-SocketIO：https://github.com/miguelgrinberg/Flask-SocketIO

---

## 🗂 模块日志汇总（按子系统）

### 📍 视觉定位模块
- 当前状态：🟡 部分完成（识别 + 解算 + 平滑）
- 使用工具：OpenCV, solvePnP, apriltag
- 数据频率：30 Hz（随摄像头帧率）
- 问题：角度跳变、反光误检

### 📍 轨迹规划模块
- 当前状态：🟢 初步完成
- 技术栈：Three.js + Flask
- 支持功能：路径绘制、航点调整、无人机实时位置显示
- TODO：轨迹插值、障碍物建模辅助

### 📍 飞控控制模块
- 当前状态：🟢 稳定运行
- 技术栈：MAVSDK Python
- 控制方式：速度控制（vx, vy, vz）
- 安全机制：Failsafe降落、视觉丢失悬停

---


## 🗓️ 每日日志

| 年份         | 📍模块   | 📌核心内容                                                                         | ✅进度                                               | 🔧问题汇总 | 🔜引用与参考链接                                                        |
|--------------|--------|--------------------------------------------------------------------------------|---------------------------------------------------|--------|------------------------------------------------------------------|
| 2025-07-10   | 项目启动   | - 确定项目核心目标与模块结构<br>- 撰写开发日志模板<br>- 制定任务计划（视觉定位→轨迹规划→人机交互）<br>- 创建Git仓库并初始化分支结构 | ✅ 已完成开发日志模板<br>✅ 明确模块负责人与阶段目标<br>✅ 初始化代码仓库与目录结构   | 无      | [开发日志模板（即本文档）]<br>[GitHub项目页](https://github.com/xxx/jcv600-uav) |

---

## 📁 附件链接（可选）

- 📸 相机标定文件：`/config/camera_intrinsics.yaml`
- 🧩 标签地图配置：`/config/apriltag_map.json`
- 🚁 飞控参数备份：`/params/px4_config.param`
- 🌐 UI 访问地址：http://192.168.1.100:5000

---
## ✅ 工作内容【2025年7月11日】

### 🎯 今日完成
- [ ] 实现了 xxx 功能（如：AprilTag 解算 + solvePnP 位姿输出）
- [ ] 成功与 MAVSDK 联调，测试 20Hz Offboard 控制指令
- [ ] Web 可视化界面实现初版，可绘制航点并显示实时位置

### 🔧 正在进行
- [ ] 调试视觉定位结果滤波（低通 / 卡尔曼）
- [ ] 优化 Flask-WebSocket 通信稳定性

### 📌 待办任务
- [ ] 实现轨迹点插值（B样条）
- [ ] 飞控 failsafe 测试（通信中断时降落）
- [ ] 部署 UI 到机载电脑并设置内网访问

---

## 🧪 测试记录

| 项目 | 指标 | 备注 |
|------|------|------|
| AprilTag 识别帧率 | 29.8 fps | 720p 分辨率，Intel i5 边缘设备 |
| 位姿误差 | ±3 cm | 相对于测量参考点 |
| MAVSDK 控制频率 | 20 Hz | USB 模式下稳定运行 |
| 可视化渲染帧率 | 60 fps | Three.js 浏览器端渲染 |

---
